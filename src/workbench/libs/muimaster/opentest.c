/*
 * opentest.c - Simple commandline unit test for MUI Master library
 * 
 * This test:
 * - Opens muimaster.library
 * - Reads and prints library base contents
 * - Verifies values are sane
 * - Closes library and exits
 */

#include <exec/types.h>
#include <exec/libraries.h>
#include <exec/execbase.h>
#include <proto/exec.h>
#include <proto/muimaster.h>
#include <libraries/mui.h>
#include <stdio.h>

int main(int argc, char *argv[])
{
    struct Library *muimaster_base;
    struct Library *exec_base;
    
    printf("MUI Master Library Test\n");
    printf("======================\n\n");
    
    /* Get ExecBase */
    exec_base = (struct Library *)SysBase;
    if (!exec_base) {
        printf("ERROR: Could not get ExecBase\n");
        return 1;
    }
    
    printf("ExecBase: 0x%08lx\n", (ULONG)exec_base);
    
    /* Open MUI Master library */
    printf("Opening muimaster.library...\n");
    muimaster_base = OpenLibrary("muimaster.library", 0);
    
    if (!muimaster_base) {
        printf("ERROR: Could not open muimaster.library\n");
        return 1;
    }
    
    printf("SUCCESS: muimaster.library opened\n");
    printf("Library Base: 0x%08lx\n\n", (ULONG)muimaster_base);
    
    /* Print library base contents */
    printf("Library Base Contents:\n");
    printf("----------------------\n");
    printf("lib_Node.ln_Type: %ld\n", muimaster_base->lib_Node.ln_Type);
    printf("lib_Node.ln_Pri: %ld\n", muimaster_base->lib_Node.ln_Pri);
    printf("lib_Node.ln_Name: %s\n", muimaster_base->lib_Node.ln_Name);
    printf("lib_Flags: 0x%08lx\n", muimaster_base->lib_Flags);
    printf("lib_Version: %ld\n", muimaster_base->lib_Version);
    printf("lib_Revision: %ld\n", muimaster_base->lib_Revision);
    printf("lib_IdString: %s\n", muimaster_base->lib_IdString);
    printf("lib_Sum: 0x%08lx\n", muimaster_base->lib_Sum);
    printf("lib_OpenCnt: %ld\n", muimaster_base->lib_OpenCnt);
    
    /* Verify values are sane */
    printf("\nSanity Checks:\n");
    printf("--------------\n");
    
    if (muimaster_base->lib_Node.ln_Type == NT_LIBRARY) {
        printf("PASS: lib_Node.ln_Type is NT_LIBRARY (%ld)\n", muimaster_base->lib_Node.ln_Type);
    } else {
        printf("FAIL: lib_Node.ln_Type is %ld (expected %ld)\n", 
               muimaster_base->lib_Node.ln_Type, NT_LIBRARY);
    }
    
    if (muimaster_base->lib_Version >= 19) {
        printf("PASS: lib_Version is %ld (>= 19)\n", muimaster_base->lib_Version);
    } else {
        printf("FAIL: lib_Version is %ld (expected >= 19)\n", muimaster_base->lib_Version);
    }
    
    if (muimaster_base->lib_Revision >= 0) {
        printf("PASS: lib_Revision is %ld (>= 0)\n", muimaster_base->lib_Revision);
    } else {
        printf("FAIL: lib_Revision is %ld (expected >= 0)\n", muimaster_base->lib_Revision);
    }
    
    if (muimaster_base->lib_OpenCnt > 0) {
        printf("PASS: lib_OpenCnt is %ld (> 0)\n", muimaster_base->lib_OpenCnt);
    } else {
        printf("WARN: lib_OpenCnt is %ld (expected > 0)\n", muimaster_base->lib_OpenCnt);
    }
    
    if (muimaster_base->lib_IdString && ((char *)muimaster_base->lib_IdString)[0] != '\0') {
        printf("PASS: lib_IdString is valid: %s\n", (char *)muimaster_base->lib_IdString);
    } else {
        printf("FAIL: lib_IdString is invalid or empty\n");
    }
    
    /* Test a simple library function */
    printf("\nTesting library function calls:\n");
    printf("-------------------------------\n");
    
    /* Test if we can call a basic function */
    if (muimaster_base->lib_OpenCnt > 0) {
        printf("PASS: Library is open and ready for function calls\n");
    } else {
        printf("FAIL: Library open count is 0\n");
    }
    
    /* Close library */
    printf("\nClosing muimaster.library...\n");
    CloseLibrary(muimaster_base);
    printf("SUCCESS: muimaster.library closed\n");
    
    printf("\nTest completed.\n");
    return 0;
}
